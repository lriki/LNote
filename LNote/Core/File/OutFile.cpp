//=============================================================================
//【 OutFile 】
//=============================================================================

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
#include "stdafx.h"
#include "Manager.h"
#include "OutFile.h"

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
namespace LNote
{
namespace Core
{
namespace File
{

//=============================================================================
// ■ OutFile クラス
//=============================================================================

	//---------------------------------------------------------------------
	// ● コンストラクタ
	//---------------------------------------------------------------------
	OutFile::OutFile( Manager* manager_, const lnChar* filename_, const void* buffer_, int size_ )
		: ASyncProcessObject	( manager_ )
        , mFilename				( filename_ )
		, mData					( buffer_ )
		, mSize					( size_ )
		, mSaveFinished		    ( false )
	{
	}

	//---------------------------------------------------------------------
	// ● デストラクタ
	//---------------------------------------------------------------------
	OutFile::~OutFile()
	{
        ASyncProcessObject::wait();
	}

	//---------------------------------------------------------------------
	// ● コンストラクタで渡したデータを保存する
	//---------------------------------------------------------------------
	void OutFile::save( bool async_ )
	{
		if ( async_ )
		{
			ASyncProcessObject::start();
		}
		else
		{
			onSaving();
		}
	}

	//---------------------------------------------------------------------
	// ● ファイル保存のコールバック
	//---------------------------------------------------------------------
	bool OutFile::onSaving()
	{
        FILE* fp = _tfopen( mFilename.c_str(), _T( "wb" ) );

        if ( fp )
        {
            fwrite( mData, 1, mSize, fp );

            fclose( fp );
        }
        return false;
	}

	


//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------

} // namespace File
} // namespace Core
} // namespace LNote

//=============================================================================
//								end of file
//=============================================================================