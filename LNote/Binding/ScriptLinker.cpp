//=============================================================================
//y ScriptLinker z
//=============================================================================

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
#include "stdafx.h"
#include "ScriptLinker.h"

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
namespace LNote
{
namespace Binding
{

//=============================================================================
// ¡ ScriptLinker
//=============================================================================

    //---------------------------------------------------------------------
    //
    //---------------------------------------------------------------------
    ScriptLinker::ScriptLinker()
        : mFileManager  (NULL)
        , mLastLine     (0)
    {
    }

    //---------------------------------------------------------------------
    //
    //---------------------------------------------------------------------
    ScriptLinker::~ScriptLinker()
    {
        clear();
    }

    //---------------------------------------------------------------------
    //
    //---------------------------------------------------------------------
    void ScriptLinker::initialize(Core::File::Manager* file_manager_)
    {
        mFileManager = file_manager_;
        clear();
    }

    //---------------------------------------------------------------------
    //
    //---------------------------------------------------------------------
    void ScriptLinker::addFile(const lnChar* filename_)
    {
        File::IInFile* sf;
        mFileManager->createInFile( &sf, filename_, LN_OPENMODE_TEXT );
        sf->load( false );

        std::string script = (char*)sf->getData();
        LN_SAFE_RELEASE(sf);

        Entry e;
        e.Filename = filename_;
        e.LineCount = Base::StringUtil::getNewLineCount(script.c_str());
        e.StartLine = mLastLine;
        mSourceEntryArray.push_back(e);
        
        mLastLine += e.LineCount;
        mScript += script;
    }

    //---------------------------------------------------------------------
    //
    //---------------------------------------------------------------------
    void ScriptLinker::clear()
    {
        mLastLine = 0;
        mSourceEntryArray.clear();
    }


//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------

} // namespace Binding
} // namespace LNote

//=============================================================================
//                              end of file
//=============================================================================